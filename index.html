<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Akuntansi Pintar</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header id="app-header">
        <img src="image.png" alt="Akuntansi Pintar Logo" id="app-logo-header">
    </header>

    <div id="main-content" class="container" style="display:none;">
        <nav class="tab-navigation">
            <button class="tab-button active" data-tab="dashboard">
                <i data-feather="home"></i> Dashboard
            </button>
            <button class="tab-button" data-tab="products">
                <i data-feather="box"></i> Produk
            </button>
            <button class="tab-button" data-tab="cashier">
                <i data-feather="shopping-cart"></i> Kasir
            </button>
            <button class="tab-button" data-tab="sales-report">
                <i data-feather="file-text"></i> Laporan Penjualan
            </button>
            <button class="tab-button" data-tab="financial-summary">
                <i data-feather="pie-chart"></i> Rekapan Keuangan
            </button>
            <button class="tab-button" data-tab="expenses">
                <i data-feather="dollar-sign"></i> Pengeluaran
            </button>
            <button class="tab-button" data-tab="user-management">
                <i data-feather="users"></i> Pengguna
            </button>
            <button class="tab-button" data-tab="settings">
                <i data-feather="settings"></i> Pengaturan
            </button>
            <button class="tab-button" id="logout-btn">
                <i data-feather="log-out"></i> Logout
            </button>
        </nav>

        <div id="dashboard" class="tab-content active">
            <h2><i data-feather="home"></i> Dashboard</h2>
            <h3 id="dashboard-welcome">Selamat Datang!</h3>
            <div class="recap-summary">
                <div class="recap-card">
                    <h3>Total Produk</h3>
                    <div class="amount" id="total-products">0</div>
                </div>
                <div class="recap-card">
                    <h3>Total Transaksi</h3>
                    <div class="amount" id="total-transactions">0</div>
                </div>
                <div class="recap-card expense">
                    <h3>Total Pengeluaran</h3>
                    <div class="amount" id="total-expenses">0</div>
                </div>
            </div>
            </div>

        <div id="products" class="tab-content">
            <h2><i data-feather="database"></i> Manajemen Produk</h2>
            <form id="add-product-form" class="form-group-grid">
                <div class="form-group">
                    <label for="new-product-name">Nama Produk:</label>
                    <input type="text" id="new-product-name" required>
                </div>
                <div class="form-group">
                    <label for="new-product-price">Harga Jual (Rp):</label>
                    <input type="number" id="new-product-price" min="0" required>
                </div>
                <div class="form-group">
                    <label for="new-product-cost-price">Harga Beli (HPP) (Rp):</label>
                    <input type="number" id="new-product-cost-price" min="0" required>
                </div>
                <div class="form-group">
                    <label for="new-product-stock">Stok:</label>
                    <input type="number" id="new-product-stock" min="0" required>
                </div>
                <div class="button-group" style="grid-column: span 2;">
                    <button type="submit" class="primary"><i data-feather="plus-circle"></i> Tambah Produk</button>
                </div>
            </form>
            <div class="form-group">
                <label for="product-search">Cari Produk:</label>
                <input type="text" id="product-search" placeholder="Cari berdasarkan nama...">
            </div>
            <table class="table">
                <thead>
                    <tr>
                        <th>Nama Produk</th>
                        <th>Harga Jual</th>
                        <th>Harga Beli (HPP)</th>
                        <th>Stok</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody id="products-table-body">
                    </tbody>
            </table>
        </div>

        <div id="cashier" class="tab-content">
            <h2><i data-feather="shopping-cart"></i> Kasir</h2>
            <div class="kasir-layout">
                <div class="left-panel">
                    <h3>Pilih Produk</h3>
                    <div class="form-group">
                        <label for="cashier-product-search">Cari Produk:</label>
                        <input type="text" id="cashier-product-search" placeholder="Cari nama produk...">
                    </div>
                    <div id="cashier-product-list" class="product-list">
                        </div>
                </div>
                <div class="right-panel">
                    <h3>Keranjang Belanja</h3>
                    <table class="table cart-table">
                        <thead>
                            <tr>
                                <th>Nama</th>
                                <th>Qty</th>
                                <th>Harga</th>
                                <th>Total</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="cart-table-body">
                            </tbody>
                    </table>
                    <div class="cart-summary">
                        <div class="summary-row">
                            <span>Subtotal:</span>
                            <span id="subtotal-display">Rp 0</span>
                        </div>
                        <div class="form-group">
                            <label for="discount-input">Diskon (Rp):</label>
                            <input type="number" id="discount-input" value="0" min="0">
                        </div>
                        <div class="summary-row total">
                            <span>Total:</span>
                            <span id="total-display">Rp 0</span>
                        </div>
                        <div class="form-group">
                            <label for="amount-paid">Jumlah Dibayar (Rp):</label>
                            <input type="number" id="amount-paid" value="0" min="0">
                        </div>
                        <div class="summary-row">
                            <span>Kembalian:</span>
                            <span id="change-display">Rp 0</span>
                        </div>
                        <div class="button-group">
                            <button id="process-payment-btn" class="success"><i data-feather="dollar-sign"></i> Proses Pembayaran</button>
                            <button id="clear-cart-btn" class="danger"><i data-feather="trash-2"></i> Kosongkan Keranjang</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="sales-report" class="tab-content">
            <h2><i data-feather="file-text"></i> Laporan Penjualan</h2>
            <div class="form-group-grid">
                <div class="form-group">
                    <label for="filter-date-from">Dari Tanggal:</label>
                    <input type="date" id="filter-date-from">
                </div>
                <div class="form-group">
                    <label for="filter-date-to">Sampai Tanggal:</label>
                    <input type="date" id="filter-date-to">
                </div>
                <div class="form-group">
                    <label for="filter-user">Filter Kasir:</label>
                    <input type="text" id="filter-user" placeholder="Nama kasir...">
                </div>
                <div class="button-group">
                    <button id="apply-filter-btn" class="secondary"><i data-feather="filter"></i> Terapkan Filter</button>
                    <button id="export-pdf-btn" class="info"><i data-feather="download"></i> Ekspor PDF</button>
                </div>
            </div>
            <table class="table">
                <thead>
                    <tr>
                        <th>ID Transaksi</th>
                        <th>Tanggal</th>
                        <th>Kasir</th>
                        <th>Item Terjual</th>
                        <th>Total</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody id="sales-report-table-body">
                    </tbody>
            </table>
        </div>

        <div id="financial-summary" class="tab-content">
            <h2><i data-feather="pie-chart"></i> Rekapan Keuangan</h2>
            <div class="form-group-grid">
                <div class="form-group">
                    <label for="financial-summary-date-from">Dari Tanggal:</label>
                    <input type="date" id="financial-summary-date-from">
                </div>
                <div class="form-group">
                    <label for="financial-summary-date-to">Sampai Tanggal:</label>
                    <input type="date" id="financial-summary-date-to">
                </div>
                <div class="button-group">
                    <button id="apply-financial-summary-filter-btn" class="secondary"><i data-feather="filter"></i> Terapkan Filter</button>
                </div>
            </div>
            <div class="recap-summary">
                <div class="recap-card">
                    <h3>Total Pendapatan</h3>
                    <div class="amount" id="total-revenue">Rp 0</div>
                </div>
                <div class="recap-card expense">
                    <h3>Total HPP (Harga Pokok Penjualan)</h3>
                    <div class="amount" id="total-hpp">Rp 0</div>
                </div>
                <div class="recap-card profit">
                    <h3>Laba Kotor</h3>
                    <div class="amount" id="total-gross-profit">Rp 0</div>
                </div>
                <div class="recap-card expense">
                    <h3>Total Pengeluaran</h3>
                    <div class="amount" id="total-expenses-summary">Rp 0</div>
                </div>
                <div class="recap-card profit">
                    <h3>Laba Bersih</h3>
                    <div class="amount" id="net-profit">Rp 0</div>
                </div>
            </div>
            <h3>Detail Pengeluaran Terfilter</h3>
            <table class="table">
                <thead>
                    <tr>
                        <th>Tanggal</th>
                        <th>Nama Pengeluaran</th>
                        <th>Jumlah</th>
                    </tr>
                </thead>
                <tbody id="financial-summary-table-body">
                    </tbody>
            </table>
            </div>

        <div id="expenses" class="tab-content">
            <h2><i data-feather="dollar-sign"></i> Pengeluaran</h2>
            <form id="add-expense-form" class="form-group-grid">
                <div class="form-group">
                    <label for="new-expense-name">Nama Pengeluaran:</label>
                    <input type="text" id="new-expense-name" required>
                </div>
                <div class="form-group">
                    <label for="new-expense-amount">Jumlah (Rp):</label>
                    <input type="number" id="new-expense-amount" min="0" required>
                </div>
                <div class="button-group" style="grid-column: span 2;">
                    <button type="submit" class="danger"><i data-feather="plus-circle"></i> Tambah Pengeluaran</button>
                </div>
            </form>
            <div class="form-group">
                <label for="expense-search">Cari Pengeluaran:</label>
                <input type="text" id="expense-search" placeholder="Cari berdasarkan nama...">
            </div>
            <table class="table">
                <thead>
                    <tr>
                        <th>Tanggal</th>
                        <th>Nama Pengeluaran</th>
                        <th>Jumlah</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody id="expenses-table-body">
                    </tbody>
            </table>
        </div>

        <div id="user-management" class="tab-content">
            <h2><i data-feather="users"></i> Manajemen Pengguna</h2>
            <form id="add-user-form" class="form-group-grid">
                <div class="form-group">
                    <label for="new-username">Username:</label>
                    <input type="text" id="new-username" required>
                </div>
                <div class="form-group">
                    <label for="new-user-password">Password:</label>
                    <input type="password" id="new-user-password" required>
                </div>
                <div class="form-group">
                    <label for="new-user-role">Role:</label>
                    <select id="new-user-role">
                        <option value="kasir">Kasir</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                <div class="button-group" style="grid-column: span 2;">
                    <button type="submit" class="primary"><i data-feather="user-plus"></i> Tambah Pengguna</button>
                </div>
            </form>
            <table class="table">
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Role</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody id="users-table-body">
                    </tbody>
            </table>
        </div>

        <div id="settings" class="tab-content">
            <h2><i data-feather="settings"></i> Pengaturan</h2>

            <div class="settings-section">
                <h3>Nama Perusahaan (Custom Header)</h3>
                <div class="form-group">
                    <label for="custom-company-name-input">Nama Perusahaan/Toko:</label>
                    <input type="text" id="custom-company-name-input" placeholder="Masukkan nama perusahaan Anda">
                </div>
                <div class="button-group">
                    <button class="primary" id="save-company-name-btn"><i data-feather="save"></i> Simpan Nama Perusahaan</button>
                </div>
            </div>

            <div class="settings-section">
                <h3>Ganti Kata Sandi</h3>
                <form id="change-password-form">
                    <div class="form-group">
                        <label for="old-password">Kata Sandi Lama:</label>
                        <input type="password" id="old-password" required>
                    </div>
                    <div class="form-group">
                        <label for="new-password">Kata Sandi Baru:</label>
                        <input type="password" id="new-password" required>
                    </div>
                    <div class="form-group">
                        <label for="confirm-new-password">Konfirmasi Kata Sandi Baru:</label>
                        <input type="password" id="confirm-new-password" required>
                    </div>
                    <div class="button-group">
                        <button type="submit" class="secondary"><i data-feather="lock"></i> Ganti Kata Sandi</button>
                    </div>
                </form>
            </div>

            <div class="settings-section">
                <h3>Hapus Semua Data Aplikasi</h3>
                <p class="settings-info" style="color: var(--danger-color); font-weight: 600;">
                    PERINGATAN: Tindakan ini akan menghapus SEMUA data aplikasi (produk, transaksi, pengeluaran, pengguna) yang tersimpan di browser Anda. Tindakan ini TIDAK DAPAT DIBATALKAN!
                </p>
                <div class="button-group">
                    <button id="clear-app-data-btn" class="danger"><i data-feather="alert-triangle"></i> Hapus Semua Data</button>
                </div>
            </div>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <div id="login-modal" class="modal active">
        <div class="modal-content login-modal-content">
            <h3>Selamat Datang di <span id="login-company-name-display">Akuntansi Pintar</span></h3>
            <p class="company-name">Sistem Keuangan Anda</p>
            <form id="login-form">
                <div class="form-group">
                    <label for="username">Username:</label>
                    <input type="text" id="username" placeholder="admin" required>
                </div>
                <div class="form-group">
                    <label for="password">Password:</label>
                    <input type="password" id="password" placeholder="adminpassword" required>
                </div>
                <div class="button-group">
                    <button type="submit" class="primary"><i data-feather="log-in"></i> Login</button>
                </div>
                <p class="info-text" id="login-message">Default Admin: username `admin`, password `adminpassword`</p>
            </form>
        </div>
    </div>

    <div id="receipt-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="close-receipt-modal-btn">&times;</span>
            <h3>Struk Penjualan</h3>
            <div id="print-receipt-content" style="display:none;">
                </div>
            <div class="button-group">
                <button class="primary" id="print-receipt-btn"><i data-feather="printer"></i> Cetak Struk</button>
            </div>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 <span id="footer-company-name">Akuntansi Pintar</span>. Hak cipta dilindungi.</p>
    </footer>

    <script src="script.js"></script>
</body>
</html>
/* --- Variabel Warna Emas Modern & Professional --- */
:root {
    --primary-gold: #B8860B; /* Dark Goldenrod */
    --primary-dark-gold: #8B6914; /* Darker Gold */
    --light-gold: #FFD700; /* Gold */
    --accent-gold: #FFC107; /* Amber Gold */
    --text-color: #4A4A4A; /* Dark Gray for text */
    --light-text-color: #8C8C8C; /* Lighter Gray for subtle text */
    --light-bg: #F8F8F8; /* Very light gray for backgrounds */
    --dark-bg: #EAEAEA; /* Slightly darker gray for subtle accents */
    --card-bg: #FFFFFF; /* White for cards */
    --border-color: #D3D3D3; /* Light gray for borders */
    --danger-color: #E74C3C; /* Red */
    --success-color: #27AE60; /* Green */
    --info-color: #3498DB; /* Blue */
    --warning-color: #F1C40F; /* Yellow */
    --shadow-light: rgba(0, 0, 0, 0.08);
    --shadow-medium: rgba(0, 0, 0, 0.15);
    --shadow-dark: rgba(0, 0, 0, 0.25);

    /* Gradients (Updated for Gold) */
    --header-gradient: linear-gradient(135deg, var(--primary-gold) 0%, var(--primary-dark-gold) 100%);
    --button-primary-gradient: linear-gradient(45deg, var(--light-gold), var(--primary-gold));
    --button-success-gradient: linear-gradient(45deg, var(--success-color), #208b4e);
    --button-danger-gradient: linear-gradient(45deg, var(--danger-color), #c0392b);
    --button-secondary-gradient: linear-gradient(45deg, var(--accent-gold), #e0a300); /* Adjusted secondary */
}

/* --- Reset & Base Styles --- */
* {
    box-sizing: border-box;
}

body {
    font-family: 'Poppins', sans-serif;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    overflow-x: hidden;
    line-height: 1.6;
    color: var(--text-color); /* Pastikan teks menggunakan variabel warna */
    
    /* --- Gaya Background Gambar Wayang --- */
    background-image: url('wayang_background.png'); /* Ganti dengan nama file PNG Anda */
    background-size: cover; /* Menyesuaikan gambar agar menutupi seluruh area */
    background-repeat: no-repeat; /* Mencegah gambar berulang */
    background-attachment: fixed; /* Membuat gambar tetap di tempat saat halaman di-scroll */
    background-position: center center; /* Memposisikan gambar di tengah */
    background-color: #333; /* Fallback color jika gambar tidak dimuat */
}

/* --- Header --- */
header {
    background: var(--header-gradient);
    color: white;
    padding: 40px 0;
    text-align: center;
    box-shadow: 0 8px 16px var(--shadow-dark);
    position: relative;
    overflow: hidden;
    /* Tambahkan transparansi agar background body terlihat samar */
    background-color: rgba(184, 134, 11, 0.85); /* Contoh: primary-gold dengan transparansi */
}
header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: url('data:image/svg+xml;utf8,<svg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"><g fill="%23ffffff" fill-opacity="0.05" fill-rule="evenodd"><path d="M0 60V0h60v60zM30 0L0 30l30 30L60 30z" fill-rule="nonzero"/></g></svg>');
    opacity: 0.2;
    pointer-events: none;
    z-index: 1;
}

/* Gaya untuk logo gambar di header */
#app-logo-header {
    max-width: 300px; /* Atur lebar maksimum logo Anda */
    height: auto;     /* Biarkan tinggi menyesuaikan agar tidak terdistorsi */
    display: block;   /* Agar bisa menggunakan margin: auto */
    margin: 0 auto;   /* Pusatkan logo secara horizontal */
    box-shadow: none; /* Hapus bayangan jika Anda tidak ingin ada bayangan pada logo */
    filter: drop-shadow(2px 2px 5px var(--shadow-dark)); /* Tambahkan bayangan jika perlu */
}


/* --- Main Container --- */
.container {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 30px;
    max-width: 1400px;
    margin: 30px auto;
    background-color: rgba(255, 255, 255, 0.9); /* Card background dengan sedikit transparansi */
    border-radius: 16px;
    box-shadow: 0 10px 30px var(--shadow-medium);
}

/* --- Tab Navigation --- */
.tab-navigation {
    display: flex;
    border-bottom: 3px solid var(--border-color);
    margin-bottom: 30px;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
    background-color: var(--dark-bg);
    border-radius: 8px;
    padding: 5px;
}
.tab-navigation::-webkit-scrollbar { display: none; }

.tab-button {
    background-color: transparent;
    border: none;
    padding: 18px 30px;
    cursor: pointer;
    font-size: 1.1em;
    font-weight: 600;
    color: var(--light-text-color);
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    flex-shrink: 0;
    position: relative;
    overflow: hidden;
    border-radius: 6px;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.tab-button:hover {
    color: var(--primary-gold);
    background-color: rgba(184, 134, 11, 0.08); /* RGB of primary-gold */
}

.tab-button.active {
    color: var(--text-color); /* Changed to dark text for gold background */
    background: var(--button-primary-gradient);
    box-shadow: 0 4px 10px var(--shadow-light);
    transform: translateY(-2px);
}
.tab-button.active::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background-color: var(--accent-gold);
}

/* --- Tab Content --- */
.tab-content {
    display: none;
    padding: 20px 0;
    flex-direction: column;
    flex: 1;
    animation: fadeIn 0.5s ease-out;
}
.tab-content.active { display: flex; }

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* --- Section Titles (H2) --- */
h2 {
    color: var(--primary-dark-gold); /* Darker gold for headers */
    margin-top: 0;
    margin-bottom: 30px;
    font-size: 2.2em;
    font-weight: 700;
    border-bottom: 4px solid var(--border-color);
    padding-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 12px;
}

h2 svg {
    color: var(--accent-gold);
    font-size: 1.3em;
}

/* --- Kasir Layout --- */
.kasir-layout {
    display: grid;
    grid-template-columns: 2fr 3fr;
    gap: 35px;
    flex: 1;
}

.left-panel, .right-panel {
    padding: 30px;
    border: 1px solid var(--border-color);
    border-radius: 12px;
    background-color: rgba(255, 255, 255, 0.8); /* Slightly transparent */
    box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.05);
    display: flex;
    flex-direction: column;
}

/* --- Form Elements --- */
.form-group {
    margin-bottom: 22px;
}

label {
    display: block;
    margin-bottom: 10px;
    font-weight: 600;
    color: var(--text-color);
    font-size: 1em;
}

input[type="text"],
input[type="number"],
input[type="password"], /* Added for user management */
input[type="date"], /* For expense and potentially other date inputs */
select,
textarea {
    width: 100%;
    padding: 14px 18px;
    border: 2px solid var(--border-color);
    border-radius: 8px;
    font-size: 1.05em;
    box-sizing: border-box;
    background-color: rgba(255, 255, 255, 0.95); /* Slightly transparent */
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
    transition: all 0.3s ease;
}
input[type="text"]:focus,
input[type="number"]:focus,
input[type="password"]:focus,
input[type="date"]:focus,
select:focus,
textarea:focus {
    border-color: var(--primary-gold); /* Gold focus */
    box-shadow: 0 0 0 4px rgba(184, 134, 11, 0.25); /* Gold focus ring */
    outline: none;
}
input[readonly] {
    background-color: var(--dark-bg);
    cursor: not-allowed;
    opacity: 0.8;
}
textarea {
    resize: vertical;
    min-height: 100px;
}

/* --- Button Group --- */
.button-group {
    display: flex;
    gap: 18px;
    margin-top: 25px;
    flex-wrap: wrap;
    justify-content: flex-start;
}
.modal .button-group, .transaction-detail .button-group {
    justify-content: center;
}
.login-modal-content .button-group {
    justify-content: center;
    margin-top: 30px;
}

button {
    padding: 14px 25px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-size: 1.05em;
    font-weight: 600;
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    white-space: nowrap;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    box-shadow: 0 4px 8px var(--shadow-light);
    color: white; /* Default to white text for most buttons */
}

button.primary { background: var(--button-primary-gradient); color: var(--text-color); } /* Dark text on gold */
button.primary:hover { transform: translateY(-3px); box-shadow: 0 6px 12px var(--shadow-medium); }

button.secondary { background: var(--button-secondary-gradient); color: var(--text-color); } /* Dark text on amber gold */
button.secondary:hover { transform: translateY(-3px); box-shadow: 0 6px 12px var(--shadow-medium); }

button.danger { background: var(--button-danger-gradient); }
button.danger:hover { transform: translateY(-3px); box-shadow: 0 6px 12px var(--shadow-medium); }

button.success { background: var(--button-success-gradient); }
button.success:hover { transform: translateY(-3px); box-shadow: 0 6px 12px var(--shadow-medium); }

button.info { background-color: var(--info-color); }
button.info:hover { background-color: #217dbb; transform: translateY(-3px); box-shadow: 0 6px 12px var(--shadow-medium); }

button.warning { background-color: var(--warning-color); color: var(--text-color); } /* Dark text on yellow */
button.warning:hover { background-color: #d8af11; transform: translateY(-3px); box-shadow: 0 6px 12px var(--shadow-medium); }

/* --- Cart Items Display --- */
.cart-items {
    flex: 1;
    margin-bottom: 30px;
    overflow-y: auto;
    max-height: 400px;
    border: 1px solid var(--border-color);
    border-radius: 10px;
    background-color: rgba(255, 255, 255, 0.8); /* Slightly transparent */
    box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.05);
}

.cart-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 20px;
    border-bottom: 1px solid var(--dark-bg);
    transition: background-color 0.2s ease;
}
.cart-item:last-child { border-bottom: none; }
.cart-item:hover { background-color: var(--dark-bg); }

.cart-item-info { flex-grow: 1; margin-right: 20px; }
.cart-item-name { font-weight: 700; color: var(--primary-gold); font-size: 1.1em; } /* Gold product name */
.cart-item-quantity, .cart-item-price-per-item { font-size: 0.9em; color: var(--light-text-color); }
.cart-item-total-price { font-weight: 700; color: var(--success-color); white-space: nowrap; font-size: 1.2em; }
.cart-item-actions button {
    padding: 8px 12px;
    font-size: 0.85em;
    border-radius: 6px;
    box-shadow: none;
    transform: none;
}
.cart-item-actions button:hover { opacity: 0.8; }
.empty-cart-message, .empty-table-message, .empty-chart-message {
    text-align: center;
    color: var(--light-text-color);
    padding: 40px;
    font-style: italic;
    font-size: 1.1em;
}

/* --- Cart Summary --- */
.cart-summary {
    margin-top: auto;
    border-top: 3px solid var(--primary-gold); /* Gold border top */
    padding-top: 25px;
}

.summary-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 15px;
    font-size: 1.15em;
    color: var(--text-color);
    font-weight: 500;
}
.summary-row.total {
    font-weight: 700;
    font-size: 1.8em;
    color: var(--primary-dark-gold); /* Darker gold for total */
    padding-top: 15px;
    border-top: 1px dashed var(--border-color);
    margin-top: 20px;
}
.summary-row.change-negative { color: var(--danger-color); }
.summary-row.change-positive { color: var(--success-color); }


/* --- Table Styles --- */
.table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 30px;
    background-color: rgba(255, 255, 255, 0.8); /* Slightly transparent */
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 5px 15px var(--shadow-light);
}

.table thead th {
    background: var(--header-gradient);
    color: white;
    padding: 16px 20px;
    text-align: left;
    border-bottom: 2px solid var(--primary-dark-gold); /* Darker gold border */
    font-weight: 600;
    font-size: 1em;
}

.table tbody td {
    padding: 14px 20px;
    border-bottom: 1px solid var(--border-color);
    color: var(--text-color);
    font-size: 0.95em;
}

.table tbody tr:nth-child(even) { background-color: var(--light-bg); }
.table tbody tr:hover { background-color: var(--dark-bg); transition: background-color 0.2s ease; }

.table-actions { display: flex; gap: 10px; }
.table-actions button {
    padding: 9px 15px;
    font-size: 0.85em;
    box-shadow: none;
    transform: none;
}
.table-actions button:hover { opacity: 0.8; }

/* --- Notification Area --- */
#notification {
    position: fixed;
    top: 30px;
    right: 30px;
    z-index: 1000;
    background-color: #333;
    color: white;
    padding: 16px 25px;
    border-radius: 12px;
    box-shadow: 0 6px 15px var(--shadow-dark);
    opacity: 0;
    visibility: hidden;
    transform: translateX(100%);
    transition: all 0.5s ease-in-out;
}
#notification.show {
    opacity: 1;
    visibility: visible;
    transform: translateX(0);
}
.notification.success { background-color: var(--success-color); }
.notification.error   { background-color: var(--danger-color); }
.notification.info    { background-color: var(--info-color); }
.notification.warning { background-color: var(--warning-color); color: var(--text-color); }


/* --- Footer --- */
footer {
    background-color: var(--text-color);
    color: white;
    text-align: center;
    padding: 25px 0;
    margin-top: 50px;
    font-size: 0.95em;
    box-shadow: 0 -5px 15px var(--shadow-medium);
    flex-shrink: 0;
    background-color: rgba(74, 74, 74, 0.85); /* Dark gray dengan transparansi */
}
footer a {
    color: var(--light-gold); /* Warna emas untuk link di footer */
    text-decoration: none;
    transition: color 0.2s ease;
}
footer a:hover {
    color: var(--accent-gold);
    text-decoration: underline;
}


/* --- Modal Styles --- */
.modal {
    position: fixed;
    z-index: 1001;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.6);
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
}
.modal.active { opacity: 1; visibility: visible; }

.modal-content {
    background-color: rgba(255, 255, 255, 0.95); /* Sedikit transparan */
    padding: 40px;
    border-radius: 16px;
    width: 95%;
    max-width: 600px;
    box-shadow: 0 15px 40px var(--shadow-dark);
    position: relative;
    transform: translateY(-30px);
    opacity: 0;
    transition: transform 0.3s ease, opacity 0.3s ease;
}
.modal.active .modal-content { transform: translateY(0); opacity: 1; }

.close-button {
    color: var(--light-text-color);
    font-size: 35px;
    font-weight: bold;
    position: absolute;
    top: 20px;
    right: 25px;
    cursor: pointer;
    transition: color 0.2s ease;
}
.close-button:hover { color: var(--danger-color); }

.modal-content h3 {
    color: var(--primary-gold); /* Gold modal header */
    margin-top: 0;
    margin-bottom: 30px;
    border-bottom: 2px solid var(--border-color);
    padding-bottom: 15px;
    font-size: 2em;
}
.modal-content ul {
    list-style: none;
    padding: 0;
    margin-top: 15px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    max-height: 200px;
    overflow-y: auto;
    background-color: var(--light-bg);
}
.modal-content ul li {
    padding: 10px 15px;
    border-bottom: 1px dashed var(--dark-bg);
    font-size: 0.95em;
    color: var(--text-color);
}
.modal-content ul li:last-child { border-bottom: none; }

.modal-content .summary-row {
    font-size: 1.1em;
    margin-bottom: 10px;
}
.modal-content .summary-row.total {
    font-size: 1.4em;
}

/* --- Rekapan Section Styles --- */
.recap-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Adjusted for more cards */
    gap: 30px;
    margin-top: 30px;
    padding: 25px;
    border: 1px solid var(--border-color);
    border-radius: 12px;
    background-color: rgba(255, 255, 255, 0.8); /* Slightly transparent */
    box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.05);
}

.recap-card {
    background-color: rgba(255, 255, 255, 0.9); /* Slightly transparent */
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 6px 15px var(--shadow-light);
    text-align: center;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}
.recap-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 12px 25px var(--shadow-medium);
}

.recap-card h3 {
    color: var(--light-text-color);
    font-size: 1.4em;
    font-weight: 600;
    margin-top: 0;
    margin-bottom: 20px;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 12px;
    text-align: center;
}

.recap-card .amount {
    font-size: 3.2em;
    font-family: 'Montserrat', sans-serif;
    font-weight: 800;
    color: var(--primary-gold); /* Gold amount */
    margin-bottom: 0;
    line-height: 1.2;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
}

.recap-card.expense .amount { color: var(--danger-color); }
.recap-card.profit .amount { color: var(--success-color); }

.chart-container {
    margin-top: 40px;
    background-color: rgba(255, 255, 255, 0.9); /* Slightly transparent */
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 6px 15px var(--shadow-light);
    max-width: 100%;
    height: 400px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}
.chart-container canvas {
    max-width: 100% !important;
    max-height: 100% !important;
}
.chart-message {
    text-align: center;
    color: var(--light-text-color);
    padding: 20px;
    font-style: italic;
}

/* Pengaturan tab specific styles */
.settings-section {
    background-color: rgba(255, 255, 255, 0.8); /* Slightly transparent */
    padding: 25px;
    border-radius: 12px;
    border: 1px solid var(--border-color);
    margin-bottom: 30px;
    box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.03);
}
.settings-section h3 {
    color: var(--primary-dark-gold);
    border-bottom: 2px solid var(--border-color);
    padding-bottom: 10px;
    margin-top: 0;
    margin-bottom: 20px;
}
.settings-info {
    font-size: 0.95em;
    color: var(--light-text-color);
    margin-top: -15px;
    margin-bottom: 20px;
}
.settings-section .button-group {
    margin-top: 20px;
    justify-content: flex-start;
}

/* Login Modal specific styles */
.login-modal-content {
    max-width: 450px;
    text-align: center;
}
.login-modal-content h3 {
    font-size: 2.5em;
    color: var(--primary-dark-gold);
    border-bottom: none;
    margin-bottom: 10px;
}
.login-modal-content .company-name {
    font-size: 1.1em;
    color: var(--light-text-color);
    margin-bottom: 30px;
}
.login-modal-content .form-group {
    text-align: left;
}
.login-modal-content label {
    font-size: 1em;
}
.login-modal-content input {
    padding: 16px 20px;
    font-size: 1.1em;
    border-radius: 10px;
}
.login-modal-content button {
    width: 100%;
    padding: 16px;
    font-size: 1.2em;
}
.login-modal-content .info-text {
    font-size: 0.9em;
    color: var(--light-text-color);
    margin-top: 25px;
}


/* Print Receipt Style */
@media print {
    body { background-color: white; margin: 0; padding: 0; color: #000; }
    header, footer, .container, .tab-navigation, #notification, .modal, button, .button-group, .settings-section { display: none !important; }
    
    /* Gaya untuk konten struk yang dicetak */
    .print-receipt-content {
        display: block !important;
        font-family: 'Consolas', 'Monospace', monospace;
        font-size: 12px;
        line-height: 1.4;
        width: 300px;
        margin: 0 auto;
        padding: 10px;
        box-sizing: border-box;
        color: #000; /* Pastikan teks hitam untuk cetak */
    }
    .print-receipt-content .header, .print-receipt-content .footer { text-align: center; margin-bottom: 10px; }
    .print-receipt-content .separator { border-top: 1px dashed #000; margin: 8px 0; }
    .print-receipt-content .item-row { display: flex; justify-content: space-between; margin-bottom: 3px; }
    .print-receipt-content .item-name { flex-grow: 1; padding-right: 5px; }
    .print-receipt-content .item-qty-price { white-space: nowrap; text-align: right; }
    .print-receipt-content .summary-row { display: flex; justify-content: space-between; font-weight: bold; margin-bottom: 5px; }
    .print-receipt-content .total-row { font-size: 1.1em; border-top: 1px dashed #000; padding-top: 5px; margin-top: 5px; }
    .print-receipt-content .text-right { text-align: right; }
    .print-receipt-content img { max-width: 100px; height: auto; display: block; margin: 0 auto; /* Ukuran logo struk yang sesuai */ }
}

/* --- Media Queries (Responsive Design) --- */
@media (max-width: 1024px) {
    .kasir-layout { grid-template-columns: 1fr; }
    .left-panel, .right-panel { margin-bottom: 25px; }
    .tab-button { padding: 15px 25px; font-size: 1em; }
    header h1 { font-size: 3.8em; } /* Penyesuaian responsif */
    h2 { font-size: 2em; }
    .recap-summary { grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
    .recap-card .amount { font-size: 2.8em; }
}

@media (max-width: 768px) {
    .container { margin: 20px; padding: 20px; }
    header h1 { font-size: 3em; } /* Penyesuaian responsif */
    .app-creator { font-size: 0.9em; }
    h2 { font-size: 1.8em; margin-bottom: 25px; }
    .tab-navigation { flex-wrap: wrap; justify-content: center; padding: 3px; }
    .tab-button { flex-basis: 49%; margin: 2px; padding: 12px 20px; font-size: 0.95em; }
    input[type="text"], input[type="number"], select, textarea { padding: 12px 15px; font-size: 0.95em; }
    button { padding: 12px 20px; font-size: 0.95em; }
    .button-group { gap: 12px; margin-top: 20px; }
    .recap-summary { grid-template-columns: 1fr; }
    .recap-card .amount { font-size: 2.5em; }
    .recap-card h3 { font-size: 1.2em; }
    .cart-item { flex-wrap: wrap; gap: 8px; padding: 12px 15px; }
    .cart-item-name { flex-basis: 100%; }
    .cart-item-info, .cart-item-total-price, .cart-item-actions { flex-grow: 1; flex-basis: auto; }
    .cart-item-actions { justify-content: flex-end; }
    .summary-row { font-size: 1em; }
    .summary-row.total { font-size: 1.5em; }
    .modal-content { padding: 30px; }
    .modal-content h3 { font-size: 1.6em; }
}

@media (max-width: 480px) {
    header h1 { font-size: 2.5em; } /* Penyesuaian responsif */
    .container { margin: 10px; padding: 15px; }
    h2 { font-size: 1.6em; }
    .tab-button { flex-basis: 100%; }
    .notification { max-width: 90%; right: 5%; left: 5%; }
    .recap-card .amount { font-size: 2em; }
    .recap-card h3 { font-size: 1.2em; }
}
// Global Variables (Data Aplikasi)
let companyName = "Akuntansi Pintar"; // Akan dimuat dari Local Storage atau default
let currentUser = null; // Pengguna yang sedang login
let products = []; // Array produk
let transactions = []; // Array transaksi
let expenses = []; // Array pengeluaran
let users = []; // Array pengguna
let cart = []; // Keranjang belanja
let currentTransactionIdCounter = 0; // Penghitung ID transaksi unik

// --- DOM Elements (Pengambilan Elemen HTML) ---

// Login
const loginModal = document.getElementById('login-modal');
const loginForm = document.getElementById('login-form');
const usernameInput = document.getElementById('username');
const passwordInput = document.getElementById('password');
const loginMessage = document.getElementById('login-message');
const loginCompanyNameDisplay = document.getElementById('login-company-name-display');

// Main Layout
const mainContent = document.getElementById('main-content');
const appHeader = document.getElementById('app-header');
const appLogoHeader = document.getElementById('app-logo-header'); // Untuk logo di header

const tabButtons = document.querySelectorAll('.tab-button'); // Tombol navigasi tab
const tabContents = document.querySelectorAll('.tab-content'); // Konten masing-masing tab
const notification = document.getElementById('notification'); // Area notifikasi

const footerCompanyName = document.getElementById('footer-company-name'); // Nama perusahaan di footer

// Dashboard Tab
const totalProductsDisplay = document.getElementById('total-products');
const totalTransactionsDisplay = document.getElementById('total-transactions');
const totalExpensesDisplay = document.getElementById('total-expenses');
const dashboardWelcome = document.getElementById('dashboard-welcome');

// Products Tab
const addProductForm = document.getElementById('add-product-form');
const newProductName = document.getElementById('new-product-name');
const newProductPrice = document.getElementById('new-product-price');
const newProductCostPrice = document.getElementById('new-product-cost-price'); // Input HPP
const newProductStock = document.getElementById('new-product-stock');
const productsTableBody = document.getElementById('products-table-body');
const productSearchInput = document.getElementById('product-search');

// Cashier Tab
const productSelect = document.getElementById('product-select'); // Dropdown pilih produk
const categoryFilter = document.getElementById('category-filter'); // Filter kategori
const productNameInput = document.getElementById('product-name'); // Nama produk (readonly)
const productPriceInput = document.getElementById('product-price'); // Harga produk (readonly)
const productStockDisplay = document.getElementById('product-stock-display'); // Stok produk (readonly)
const productQuantityInput = document.getElementById('product-quantity'); // Kuantitas produk
const addToCartBtn = document.getElementById('add-to-cart-btn'); // Tambah ke keranjang
const clearInputBtn = document.getElementById('clear-input-btn'); // Bersihkan input kasir
const cartTableBody = document.getElementById('cart-table-body'); // Body tabel keranjang
const subtotalDisplay = document.getElementById('subtotal-display'); // Subtotal
const discountInput = document.getElementById('discount-input'); // Diskon
const totalDisplay = document.getElementById('total-display'); // Total pembayaran
const amountPaidInput = document.getElementById('amount-paid'); // Jumlah dibayar
const changeDisplay = document.getElementById('change-display'); // Kembalian
const processPaymentBtn = document.getElementById('process-payment-btn'); // Proses pembayaran
const clearCartBtn = document.getElementById('clear-cart-btn'); // Kosongkan keranjang

// Sales Report Tab
const salesReportTableBody = document.getElementById('sales-report-table-body');
const filterDateFrom = document.getElementById('filter-date-from');
const filterDateTo = document.getElementById('filter-date-to');
const filterUser = document.getElementById('filter-user'); // Filter kasir
const applyFilterBtn = document.getElementById('apply-filter-btn');
const exportPdfBtn = document.getElementById('export-pdf-btn');

// Financial Summary Tab
const financialSummaryTableBody = document.getElementById('financial-summary-table-body');
const financialSummaryDateFrom = document.getElementById('financial-summary-date-from');
const financialSummaryDateTo = document.getElementById('financial-summary-date-to');
const applyFinancialSummaryFilterBtn = document.getElementById('apply-financial-summary-filter-btn');
const totalRevenueDisplay = document.getElementById('total-revenue');
const totalHppDisplay = document.getElementById('total-hpp');
const totalGrossProfitDisplay = document.getElementById('total-gross-profit');
const totalExpensesSummaryDisplay = document.getElementById('total-expenses-summary');
const netProfitDisplay = document.getElementById('net-profit');

// Expenses Tab
const addExpenseForm = document.getElementById('add-expense-form');
const newExpenseName = document.getElementById('new-expense-name');
const newExpenseAmount = document.getElementById('new-expense-amount');
const expensesTableBody = document.getElementById('expenses-table-body');
const expenseSearchInput = document.getElementById('expense-search');

// User Management Tab
const addUserForm = document.getElementById('add-user-form');
const newUsername = document.getElementById('new-username');
const newUserPassword = document.getElementById('new-user-password');
const newUserRole = document.getElementById('new-user-role');
const usersTableBody = document.getElementById('users-table-body');

// Settings Tab
const customCompanyNameInput = document.getElementById('custom-company-name-input'); // Input untuk nama perusahaan kustom
const saveCompanyNameBtn = document.getElementById('save-company-name-btn'); // Tombol simpan nama perusahaan kustom
const changePasswordForm = document.getElementById('change-password-form');
const oldPasswordInput = document.getElementById('old-password');
const newPasswordInput = document.getElementById('new-password');
const confirmNewPasswordInput = document.getElementById('confirm-new-password');
const clearAppDataBtn = document.getElementById('clear-app-data-btn');
const logoutBtnInSettings = document.getElementById('logout-btn'); // Logout button in navigation

// Receipt Modal
const receiptModal = document.getElementById('receipt-modal');
const printReceiptContent = document.getElementById('print-receipt-content');
const closeReceiptModalBtn = document.getElementById('close-receipt-modal-btn');
const printReceiptInModalBtn = document.getElementById('print-receipt-btn'); // Tombol cetak di modal struk

// --- Utility Functions ---
function showNotification(message, type = 'success') {
    notification.textContent = message;
    notification.className = `notification ${type} show`;
    setTimeout(() => {
        notification.classList.remove('show');
    }, 3000);
}

function formatRupiah(number) {
    return new Intl.NumberFormat('id-ID', {
        style: 'currency',
        currency: 'IDR',
        minimumFractionDigits: 0
    }).format(number);
}

function generateUniqueId() {
    return Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
}

function saveToLocalStorage() {
    localStorage.setItem('companyName', companyName);
    localStorage.setItem('products', JSON.stringify(products));
    localStorage.setItem('transactions', JSON.stringify(transactions));
    localStorage.setItem('expenses', JSON.stringify(expenses));
    localStorage.setItem('users', JSON.stringify(users));
    localStorage.setItem('currentTransactionIdCounter', currentTransactionIdCounter);
}

function loadFromLocalStorage() {
    companyName = localStorage.getItem('companyName') || "Akuntansi Pintar";
    products = JSON.parse(localStorage.getItem('products')) || [];
    transactions = JSON.parse(localStorage.getItem('transactions')) || [];
    expenses = JSON.parse(localStorage.getItem('expenses')) || [];
    users = JSON.parse(localStorage.getItem('users')) || [];
    currentTransactionIdCounter = parseInt(localStorage.getItem('currentTransactionIdCounter')) || 0;

    // Add default admin user if no users exist
    if (users.length === 0) {
        users.push({ username: 'admin', password: 'adminpassword', role: 'admin' });
        saveToLocalStorage();
    }
}

// --- Company Name Display Management (Custom Header Feature) ---
function updateCompanyNameDisplay() {
    // Update logo's alt text if using image in header
    if (appLogoHeader) {
        appLogoHeader.alt = `${companyName} Logo`;
        // Anda juga bisa mengatur src logo di sini jika ingin logo berubah berdasarkan nama perusahaan
        // Contoh: appLogoHeader.src = `images/${companyName.toLowerCase().replace(/\s/g, '_')}_logo.png`;
    }

    // Update company name in login modal and footer
    loginCompanyNameDisplay.textContent = companyName;
    footerCompanyName.textContent = companyName;

    // Update the input field in Settings tab
    if (customCompanyNameInput) {
        customCompanyNameInput.value = companyName;
    }
}

// --- Render Functions for Tabs ---
function renderDashboard() {
    totalProductsDisplay.textContent = products.length;
    totalTransactionsDisplay.textContent = transactions.length;
    totalExpensesDisplay.textContent = expenses.length;
    dashboardWelcome.textContent = `Selamat Datang, ${currentUser.username}!`;
}

function renderProductsTable(filter = '') {
    productsTableBody.innerHTML = '';
    const filteredProducts = products.filter(product =>
        product.name.toLowerCase().includes(filter.toLowerCase())
    );
    if (filteredProducts.length === 0) {
        productsTableBody.innerHTML = '<tr><td colspan="5" class="empty-table-message">Belum ada produk yang tercatat.</td></tr>';
    }
    filteredProducts.forEach(product => {
        const row = productsTableBody.insertRow();
        row.insertCell(0).textContent = product.name;
        row.insertCell(1).textContent = formatRupiah(product.price);
        row.insertCell(2).textContent = formatRupiah(product.costPrice);
        row.insertCell(3).textContent = product.stock;
        const actionCell = row.insertCell(4);
        const editBtn = document.createElement('button');
        editBtn.innerHTML = '<i data-feather="edit"></i> Edit';
        editBtn.className = 'btn secondary btn-sm';
        editBtn.onclick = () => editProduct(product.id);
        actionCell.appendChild(editBtn);

        const deleteBtn = document.createElement('button');
        deleteBtn.innerHTML = '<i data-feather="trash"></i> Hapus';
        deleteBtn.className = 'btn danger btn-sm ml-1';
        deleteBtn.onclick = () => deleteProduct(product.id);
        actionCell.appendChild(deleteBtn);
    });
    feather.replace(); // Render feather icons for new buttons
}

function populateCashierProductSelect() {
    // Clear previous options
    productSelect.innerHTML = '<option value="">-- Pilih Produk --</option>';
    const categories = new Set(products.map(p => p.category || 'Tidak Berkategori'));
    
    // Populate categories filter
    categoryFilter.innerHTML = '<option value="">-- Semua Kategori --</option>';
    categories.forEach(cat => {
        const option = document.createElement('option');
        option.value = cat;
        option.textContent = cat;
        categoryFilter.appendChild(option);
    });

    // Add all products to the main product select initially
    products.forEach(product => {
        if (product.stock > 0) {
            const option = document.createElement('option');
            option.value = product.id;
            option.textContent = `${product.name} (Stok: ${product.stock})`;
            productSelect.appendChild(option);
        }
    });
}

function filterCashierProductSelect() {
    const selectedCategory = categoryFilter.value;
    productSelect.innerHTML = '<option value="">-- Pilih Produk --</option>';
    
    const filteredProducts = products.filter(p => {
        const matchesCategory = selectedCategory === '' || (p.category && p.category === selectedCategory);
        return matchesCategory && p.stock > 0;
    });

    filteredProducts.forEach(product => {
        const option = document.createElement('option');
        option.value = product.id;
        option.textContent = `${product.name} (Stok: ${product.stock})`;
        productSelect.appendChild(option);
    });
    // Reset product details input after filtering
    clearCashierInputs();
}

function renderCart() {
    cartTableBody.innerHTML = '';
    let subtotal = 0;
    if (cart.length === 0) {
        cartTableBody.innerHTML = '<tr><td colspan="5" class="empty-table-message">Keranjang kosong.</td></tr>';
    }
    cart.forEach(item => {
        const row = cartTableBody.insertRow();
        row.insertCell(0).textContent = item.name;
        row.insertCell(1).textContent = item.quantity;
        row.insertCell(2).textContent = formatRupiah(item.price);
        row.insertCell(3).textContent = formatRupiah(item.total);
        const actionCell = row.insertCell(4);
        const removeBtn = document.createElement('button');
        removeBtn.innerHTML = '<i data-feather="trash-2"></i>';
        removeBtn.className = 'btn danger btn-sm';
        removeBtn.onclick = () => removeFromCart(item.id);
        actionCell.appendChild(removeBtn);
        subtotal += item.total;
    });
    subtotalDisplay.textContent = formatRupiah(subtotal);
    calculateTotal(); // Recalculate total after cart changes
    feather.replace(); // Render feather icons
}

function renderSalesReport(transactionsToRender = transactions) {
    salesReportTableBody.innerHTML = '';
    if (transactionsToRender.length === 0) {
        salesReportTableBody.innerHTML = '<tr><td colspan="6" class="empty-table-message">Tidak ada transaksi yang tercatat.</td></tr>';
    }
    transactionsToRender.forEach(trans => {
        const row = salesReportTableBody.insertRow();
        row.insertCell(0).textContent = trans.id;
        row.insertCell(1).textContent = trans.date;
        row.insertCell(2).textContent = trans.userId;
        row.insertCell(3).textContent = trans.items.map(item => `${item.name} (${item.quantity})`).join(', ');
        row.insertCell(4).textContent = formatRupiah(trans.total);
        const actionCell = row.insertCell(5);
        const viewBtn = document.createElement('button');
        viewBtn.innerHTML = '<i data-feather="eye"></i> Detail Struk';
        viewBtn.className = 'btn info btn-sm';
        viewBtn.onclick = () => {
            generateReceiptContent(trans);
            receiptModal.classList.add('active'); // Show receipt modal
        };
        actionCell.appendChild(viewBtn);
    });
    feather.replace();
}

function renderFinancialSummary() {
    financialSummaryTableBody.innerHTML = '';
    const fromDate = financialSummaryDateFrom.value ? new Date(financialSummaryDateFrom.value) : null;
    const toDate = financialSummaryDateTo.value ? new Date(financialSummaryDateTo.value) : null;

    let totalRevenue = 0;
    let totalHPP = 0;
    let totalExpensesSum = 0;

    const filteredTransactions = transactions.filter(trans => {
        const transDate = new Date(trans.date.split('/').reverse().join('-')); // Convert DD/MM/YYYY to YYYY-MM-DD for Date object
        return (!fromDate || transDate >= fromDate) && (!toDate || transDate <= toDate);
    });

    filteredTransactions.forEach(trans => {
        totalRevenue += trans.total;
        trans.items.forEach(item => {
            totalHPP += item.costPrice * item.quantity;
        });
    });

    const filteredExpenses = expenses.filter(exp => {
        // Assuming expense.date is already in YYYY-MM-DD or compatible format from input
        const expDate = new Date(exp.date);
        return (!fromDate || expDate >= fromDate) && (!toDate || expDate <= toDate);
    });

    filteredExpenses.forEach(exp => {
        totalExpensesSum += exp.amount;
        const row = financialSummaryTableBody.insertRow();
        row.insertCell(0).textContent = exp.date;
        row.insertCell(1).textContent = exp.name;
        row.insertCell(2).textContent = formatRupiah(exp.amount);
    });
    if (filteredExpenses.length === 0) {
         financialSummaryTableBody.innerHTML = '<tr><td colspan="3" class="empty-table-message">Tidak ada pengeluaran untuk periode ini.</td></tr>';
    }


    const grossProfit = totalRevenue - totalHPP;
    const netProfit = grossProfit - totalExpensesSum;

    totalRevenueDisplay.textContent = formatRupiah(totalRevenue);
    totalHppDisplay.textContent = formatRupiah(totalHPP);
    totalGrossProfitDisplay.textContent = formatRupiah(grossProfit);
    totalExpensesSummaryDisplay.textContent = formatRupiah(totalExpensesSum);
    netProfitDisplay.textContent = formatRupiah(netProfit);
}

function renderExpensesTable(filter = '') {
    expensesTableBody.innerHTML = '';
    const filteredExpenses = expenses.filter(expense =>
        expense.name.toLowerCase().includes(filter.toLowerCase())
    );
    if (filteredExpenses.length === 0) {
        expensesTableBody.innerHTML = '<tr><td colspan="4" class="empty-table-message">Belum ada pengeluaran yang tercatat.</td></tr>';
    }
    filteredExpenses.forEach(expense => {
        const row = expensesTableBody.insertRow();
        row.insertCell(0).textContent = expense.date;
        row.insertCell(1).textContent = expense.name;
        row.insertCell(2).textContent = formatRupiah(expense.amount);
        const actionCell = row.insertCell(3);
        const editBtn = document.createElement('button');
        editBtn.innerHTML = '<i data-feather="edit"></i> Edit';
        editBtn.className = 'btn secondary btn-sm';
        editBtn.onclick = () => editExpense(expense.id);
        actionCell.appendChild(editBtn);

        const deleteBtn = document.createElement('button');
        deleteBtn.innerHTML = '<i data-feather="trash"></i> Hapus';
        deleteBtn.className = 'btn danger btn-sm ml-1';
        deleteBtn.onclick = () => deleteExpense(expense.id);
        actionCell.appendChild(deleteBtn);
    });
    feather.replace();
}

function renderUsersTable() {
    usersTableBody.innerHTML = '';
    if (users.length === 0) {
        usersTableBody.innerHTML = '<tr><td colspan="3" class="empty-table-message">Belum ada pengguna.</td></tr>';
    }
    users.forEach(user => {
        const row = usersTableBody.insertRow();
        row.insertCell(0).textContent = user.username;
        row.insertCell(1).textContent = user.role;
        const actionCell = row.insertCell(2);
        if (user.username !== 'admin') { // Prevent deleting default admin
            const deleteBtn = document.createElement('button');
            deleteBtn.innerHTML = '<i data-feather="trash"></i> Hapus';
            deleteBtn.className = 'btn danger btn-sm';
            deleteBtn.onclick = () => deleteUser(user.username);
            actionCell.appendChild(deleteBtn);
        }
    });
    feather.replace();
}

// --- CRUD Operations for Data ---

// Products
addProductForm.addEventListener('submit', (event) => {
    event.preventDefault();
    const name = newProductName.value.trim();
    const price = parseFloat(newProductPrice.value);
    const costPrice = parseFloat(newProductCostPrice.value);
    const stock = parseInt(newProductStock.value);
    const category = "Umum"; // Default category, you can add an input for this

    if (name && !isNaN(price) && !isNaN(costPrice) && !isNaN(stock) && price >= 0 && costPrice >= 0 && stock >= 0) {
        products.push({ id: generateUniqueId(), name, price, costPrice, stock, category });
        saveToLocalStorage();
        renderProductsTable();
        populateCashierProductSelect(); // Update cashier product list
        addProductForm.reset();
        showNotification('Produk berhasil ditambahkan!');
    } else {
        showNotification('Mohon isi semua kolom dengan benar.', 'error');
    }
});

function editProduct(productId) {
    const product = products.find(p => p.id === productId);
    if (product) {
        const newName = prompt('Masukkan nama produk baru:', product.name);
        const newPrice = prompt('Masukkan harga jual baru:', product.price);
        const newCostPrice = prompt('Masukkan harga beli (HPP) baru:', product.costPrice);
        const newStock = prompt('Masukkan stok baru:', product.stock);
        const newCategory = prompt('Masukkan kategori baru:', product.category || 'Umum');

        if (newName !== null && newPrice !== null && newCostPrice !== null && newStock !== null && newCategory !== null) {
            const parsedPrice = parseFloat(newPrice);
            const parsedCostPrice = parseFloat(newCostPrice);
            const parsedStock = parseInt(newStock);

            if (newName.trim() && !isNaN(parsedPrice) && !isNaN(parsedCostPrice) && !isNaN(parsedStock) && parsedPrice >= 0 && parsedCostPrice >= 0 && parsedStock >= 0) {
                product.name = newName.trim();
                product.price = parsedPrice;
                product.costPrice = parsedCostPrice;
                product.stock = parsedStock;
                product.category = newCategory.trim() || 'Umum';
                saveToLocalStorage();
                renderProductsTable();
                populateCashierProductSelect(); // Update cashier product list
                showNotification('Produk berhasil diupdate!');
            } else {
                showNotification('Input tidak valid. Mohon masukkan angka yang benar.', 'error');
            }
        }
    }
}

function deleteProduct(productId) {
    if (confirm('Apakah Anda yakin ingin menghapus produk ini?')) {
        products = products.filter(p => p.id !== productId);
        saveToLocalStorage();
        renderProductsTable();
        populateCashierProductSelect(); // Update cashier product list
        showNotification('Produk berhasil dihapus!');
    }
}

// Cashier
productSelect.addEventListener('change', () => {
    const selectedProduct = products.find(p => p.id === productSelect.value);
    if (selectedProduct) {
        productNameInput.value = selectedProduct.name;
        productPriceInput.value = selectedProduct.price;
        productStockDisplay.value = selectedProduct.stock;
        productQuantityInput.value = 1;
    } else {
        clearCashierInputs();
    }
});

categoryFilter.addEventListener('change', filterCashierProductSelect);


addToCartBtn.addEventListener('click', () => {
    const productId = productSelect.value;
    const quantity = parseInt(productQuantityInput.value);

    if (!productId || isNaN(quantity) || quantity <= 0) {
        showNotification('Mohon pilih produk dan masukkan kuantitas yang valid.', 'error');
        return;
    }

    const product = products.find(p => p.id === productId);
    if (!product || product.stock < quantity) {
        showNotification('Stok tidak cukup atau produk tidak ditemukan.', 'error');
        return;
    }

    const existingCartItem = cart.find(item => item.id === productId);
    if (existingCartItem) {
        existingCartItem.quantity += quantity;
        existingCartItem.total = existingCartItem.quantity * existingCartItem.price;
    } else {
        cart.push({
            id: product.id,
            name: product.name,
            price: product.price,
            costPrice: product.costPrice, // Include HPP
            quantity: quantity,
            total: product.price * quantity
        });
    }
    product.stock -= quantity; // Kurangi stok
    saveToLocalStorage(); // Simpan perubahan stok
    renderCart();
    populateCashierProductSelect(); // Perbarui daftar produk kasir
    clearCashierInputs();
    showNotification(`${quantity}x ${product.name} ditambahkan.`);
});

clearInputBtn.addEventListener('click', clearCashierInputs);

function clearCashierInputs() {
    productSelect.value = '';
    productNameInput.value = '';
    productPriceInput.value = '';
    productStockDisplay.value = '';
    productQuantityInput.value = 1;
}

discountInput.addEventListener('input', calculateTotal);
amountPaidInput.addEventListener('input', calculateChange);
processPaymentBtn.addEventListener('click', processPayment);
clearCartBtn.addEventListener('click', clearCart);

function calculateTotal() {
    let subtotal = cart.reduce((sum, item) => sum + item.total, 0);
    let discount = parseFloat(discountInput.value) || 0;
    let total = subtotal - discount;
    totalDisplay.textContent = formatRupiah(total);
    calculateChange();
}

function calculateChange() {
    let total = parseFloat(totalDisplay.textContent.replace(/[^0-9,-]+/g, "").replace(',', '.'));
    let amountPaid = parseFloat(amountPaidInput.value) || 0;
    let change = amountPaid - total;
    changeDisplay.textContent = formatRupiah(change);

    if (change < 0) {
        changeDisplay.style.color = 'var(--danger-color)';
    } else {
        changeDisplay.style.color = 'var(--success-color)';
    }
}

function processPayment() {
    if (cart.length === 0) {
        showNotification('Keranjang belanja kosong!', 'error');
        return;
    }
    let total = parseFloat(totalDisplay.textContent.replace(/[^0-9,-]+/g, "").replace(',', '.'));
    let amountPaid = parseFloat(amountPaidInput.value) || 0;
    if (amountPaid < total) {
        showNotification('Jumlah pembayaran kurang!', 'error');
        return;
    }

    currentTransactionIdCounter++;
    const newTransaction = {
        id: `TRX-${currentTransactionIdCounter}`,
        date: new Date().toLocaleDateString('id-ID'),
        time: new Date().toLocaleTimeString('id-ID'),
        userId: currentUser ? currentUser.username : 'Guest', // Catat kasir
        items: JSON.parse(JSON.stringify(cart)), // Deep copy
        subtotal: cart.reduce((sum, item) => sum + item.total, 0),
        discountAmount: parseFloat(discountInput.value) || 0,
        total: total,
        amountPaid: amountPaid,
        change: amountPaid - total
    };

    transactions.push(newTransaction);
    saveToLocalStorage();
    showNotification('Pembayaran berhasil diproses!');

    generateReceiptContent(newTransaction);
    receiptModal.classList.add('active'); // Tampilkan modal struk

    cart = []; // Kosongkan keranjang
    renderCart();
    clearCashierInputs();
    discountInput.value = 0;
    amountPaidInput.value = 0;
    calculateTotal();
    renderDashboard(); // Update dashboard
}

function clearCart() {
    if (confirm('Apakah Anda yakin ingin mengosongkan keranjang? Stok akan dikembalikan.')) {
        cart.forEach(item => {
            const product = products.find(p => p.id === item.id);
            if (product) product.stock += item.quantity;
        });
        cart = [];
        saveToLocalStorage();
        renderCart();
        populateCashierProductSelect(); // Perbarui daftar produk kasir
        showNotification('Keranjang dikosongkan. Stok dikembalikan.');
    }
}

// Sales Report
applyFilterBtn.addEventListener('click', applySalesReportFilter);

function applySalesReportFilter() {
    const fromDate = filterDateFrom.value ? new Date(filterDateFrom.value) : null;
    const toDate = filterDateTo.value ? new Date(filterDateTo.value) : null;
    const userFilterText = filterUser.value.toLowerCase();

    const filteredTransactions = transactions.filter(trans => {
        const transDate = new Date(trans.date.split('/').reverse().join('-')); // Ubah format tanggal untuk perbandingan
        const matchesDate = (!fromDate || transDate >= fromDate) && (!toDate || transDate <= toDate);
        const matchesUser = !userFilterText || trans.userId.toLowerCase().includes(userFilterText);
        return matchesDate && matchesUser;
    });
    renderSalesReport(filteredTransactions);
}

exportPdfBtn.addEventListener('click', () => {
    // Pastikan jsPDF sudah dimuat
    if (typeof window.jspdf === 'undefined' || typeof window.jspdf.AutoTable === 'undefined') {
        showNotification('Error: Library PDF (jsPDF) belum dimuat dengan benar.', 'error');
        console.error('jsPDF or jspdf-autotable not loaded.');
        return;
    }

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    doc.setFontSize(16);
    doc.text(`${companyName} - Laporan Penjualan`, 10, 10);
    doc.setFontSize(10);
    doc.text(`Dicetak oleh: ${currentUser ? currentUser.username : 'N/A'} pada ${new Date().toLocaleDateString('id-ID')}`, 10, 17);

    // Kumpulkan data tabel yang sedang ditampilkan
    const tableData = [];
    salesReportTableBody.querySelectorAll('tr').forEach(row => {
        if (!row.querySelector('.empty-table-message')) { // Lewati pesan kosong
            const rowData = [];
            row.querySelectorAll('td').forEach((cell, index) => {
                if (index < 5) { // Exclude the 'Aksi' column (index 5)
                    rowData.push(cell.textContent);
                }
            });
            tableData.push(rowData);
        }
    });

    doc.autoTable({
        head: [['ID Transaksi', 'Tanggal', 'Kasir', 'Item Terjual', 'Total']],
        body: tableData,
        startY: 25,
        styles: { fontSize: 8, cellPadding: 2, overflow: 'linebreak' },
        headStyles: { fillColor: [52, 152, 219] }, // Warna biru untuk header tabel
        margin: { top: 20 }
    });

    doc.save(`${companyName}_Laporan_Penjualan_${new Date().toISOString().split('T')[0]}.pdf`);
    showNotification('Laporan penjualan diekspor sebagai PDF.');
});


// Financial Summary
applyFinancialSummaryFilterBtn.addEventListener('click', renderFinancialSummary);

// Expenses
addExpenseForm.addEventListener('submit', (event) => {
    event.preventDefault();
    const name = newExpenseName.value.trim();
    const amount = parseFloat(newExpenseAmount.value);
    const date = new Date().toISOString().split('T')[0]; // Format YYYY-MM-DD

    if (name && !isNaN(amount) && amount >= 0) {
        expenses.push({ id: generateUniqueId(), date, name, amount });
        saveToLocalStorage();
        renderExpensesTable();
        renderFinancialSummary(); // Update financial summary
        addExpenseForm.reset();
        showNotification('Pengeluaran berhasil ditambahkan!');
    } else {
        showNotification('Mohon isi semua kolom dengan benar.', 'error');
    }
});

function editExpense(expenseId) {
    const expense = expenses.find(e => e.id === expenseId);
    if (expense) {
        const newName = prompt('Masukkan nama pengeluaran baru:', expense.name);
        const newAmount = prompt('Masukkan jumlah pengeluaran baru:', expense.amount);
        const newDate = prompt('Masukkan tanggal pengeluaran baru (YYYY-MM-DD):', expense.date);

        if (newName !== null && newAmount !== null && newDate !== null) {
            const parsedAmount = parseFloat(newAmount);
            if (newName.trim() && !isNaN(parsedAmount) && parsedAmount >= 0 && newDate.match(/^\d{4}-\d{2}-\d{2}$/)) {
                expense.name = newName.trim();
                expense.amount = parsedAmount;
                expense.date = newDate;
                saveToLocalStorage();
                renderExpensesTable();
                renderFinancialSummary();
                showNotification('Pengeluaran berhasil diupdate!');
            } else {
                showNotification('Input tidak valid. Mohon masukkan nama, jumlah angka, dan tanggal dengan format YYYY-MM-DD.', 'error');
            }
        }
    }
}

function deleteExpense(expenseId) {
    if (confirm('Apakah Anda yakin ingin menghapus pengeluaran ini?')) {
        expenses = expenses.filter(e => e.id !== expenseId);
        saveToLocalStorage();
        renderExpensesTable();
        renderFinancialSummary(); // Update financial summary
        showNotification('Pengeluaran berhasil dihapus!');
    }
}

expenseSearchInput.addEventListener('input', (event) => renderExpensesTable(event.target.value));

// User Management
addUserForm.addEventListener('submit', (event) => {
    event.preventDefault();
    const username = newUsername.value.trim();
    const password = newUserPassword.value;
    const role = newUserRole.value;

    if (username && password && users.every(u => u.username !== username)) {
        users.push({ username, password, role });
        saveToLocalStorage();
        renderUsersTable();
        addUserForm.reset();
        showNotification('Pengguna berhasil ditambahkan!');
    } else {
        showNotification('Username sudah ada atau input tidak valid.', 'error');
    }
});

function deleteUser(usernameToDelete) {
    if (confirm(`Apakah Anda yakin ingin menghapus pengguna ${usernameToDelete}?`)) {
        users = users.filter(u => u.username !== usernameToDelete);
        saveToLocalStorage();
        renderUsersTable();
        showNotification('Pengguna berhasil dihapus!');
    }
}

// Settings
if (saveCompanyNameBtn) {
    saveCompanyNameBtn.addEventListener('click', () => {
        const newName = customCompanyNameInput.value.trim();
        if (newName) {
            companyName = newName;
            saveToLocalStorage();
            updateCompanyNameDisplay(); // Perbarui tampilan nama perusahaan di seluruh aplikasi
            showNotification('Nama perusahaan berhasil diubah!');
        } else {
            showNotification('Nama perusahaan tidak boleh kosong.', 'error');
        }
    });
}


changePasswordForm.addEventListener('submit', (event) => {
    event.preventDefault();
    const oldPass = oldPasswordInput.value;
    const newPass = newPasswordInput.value;
    const confirmNewPass = confirmNewPasswordInput.value;

    if (!currentUser) {
        showNotification('Anda tidak login.', 'error');
        return;
    }

    if (currentUser.password !== oldPass) {
        showNotification('Kata sandi lama salah!', 'error');
        return;
    }
    if (newPass !== confirmNewPass) {
        showNotification('Konfirmasi kata sandi baru tidak cocok!', 'error');
        return;
    }
    if (newPass.length < 6) {
        showNotification('Kata sandi baru minimal 6 karakter!', 'error');
        return;
    }

    const userIndex = users.findIndex(u => u.username === currentUser.username);
    if (userIndex > -1) {
        users[userIndex].password = newPass;
        currentUser.password = newPass; // Update current session user's password
        saveToLocalStorage();
        changePasswordForm.reset();
        showNotification('Kata sandi berhasil diubah!');
    }
});

clearAppDataBtn.addEventListener('click', () => {
    if (confirm('Apakah Anda yakin ingin menghapus SEMUA data aplikasi? Ini tidak bisa dibatalkan!')) {
        localStorage.clear();
        showNotification('Semua data aplikasi telah dihapus. Reloading...', 'info');
        setTimeout(() => location.reload(), 1500); // Reload the page to reset everything
    }
});

// --- Login / Logout ---
loginForm.addEventListener('submit', (event) => {
    event.preventDefault(); // Mencegah reload halaman
    const username = usernameInput.value;
    const password = passwordInput.value;

    const user = users.find(u => u.username === username && u.password === password);

    if (user) {
        currentUser = user;
        loginModal.classList.remove('active'); // Sembunyikan modal dengan class
        loginModal.style.display = 'none'; // Pastikan modal tersembunyi sepenuhnya
        mainContent.style.display = 'flex'; // Tampilkan konten utama
        appHeader.style.display = 'flex'; // Tampilkan header
        updateCompanyNameDisplay(); // Perbarui nama perusahaan di UI setelah login
        setActiveTab('dashboard'); // Arahkan ke dashboard
        showNotification(`Selamat datang, ${currentUser.username}!`);
    } else {
        loginMessage.textContent = 'Username atau password salah!';
        showNotification('Username atau password salah!', 'error');
    }
});

logoutBtnInSettings.addEventListener('click', () => {
    if (confirm('Anda yakin ingin logout?')) {
        currentUser = null;
        saveToLocalStorage(); // Simpan status tanpa user login
        loginModal.classList.add('active'); // Tampilkan modal login
        loginModal.style.display = 'flex'; // Pastikan modal login terlihat
        mainContent.style.display = 'none'; // Sembunyikan konten utama
        appHeader.style.display = 'none'; // Sembunyikan header
        usernameInput.value = '';
        passwordInput.value = '';
        loginMessage.textContent = '';
        showNotification('Anda telah logout.');
    }
});

// --- Initial Load ---
document.addEventListener('DOMContentLoaded', () => {
    loadFromLocalStorage(); // Muat data dari local storage
    updateCompanyNameDisplay(); // Perbarui tampilan nama perusahaan di awal

    // Atur tampilan awal berdasarkan status login
    if (currentUser) {
        loginModal.classList.remove('active');
        loginModal.style.display = 'none';
        mainContent.style.display = 'flex';
        appHeader.style.display = 'flex';
        setActiveTab('dashboard'); // Aktifkan tab dashboard
    } else {
        loginModal.classList.add('active');
        loginModal.style.display = 'flex';
        mainContent.style.display = 'none';
        appHeader.style.display = 'none';
    }

    feather.replace(); // Inisialisasi ikon Feather

    // Set tanggal default untuk filter laporan jika kosong
    const today = new Date();
    const month = (today.getMonth() + 1).toString().padStart(2, '0');
    const year = today.getFullYear();
    if (!filterDateFrom.value && !filterDateTo.value) {
        filterDateFrom.value = `${year}-${month}-01`;
        filterDateTo.value = `${year}-${month}-${new Date(year, month, 0).getDate()}`;
    }
    if (!financialSummaryDateFrom.value && !financialSummaryDateTo.value) {
        financialSummaryDateFrom.value = `${year}-${month}-01`;
        financialSummaryDateTo.value = `${year}-${month}-${new Date(year, month, 0).getDate()}`;
    }
});

